<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stydio - Music for Students</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
            color: #e1e5f2;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .logo {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(45deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .tagline {
            color: #8892b0;
            font-size: 1.1rem;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 30px;
            margin-bottom: 20px;
        }

        .left-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .mode-toggle {
            display: flex;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 5px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .mode-btn {
            flex: 1;
            padding: 12px 20px;
            background: transparent;
            border: none;
            color: #8892b0;
            cursor: pointer;
            border-radius: 10px;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .mode-btn.active {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .spotify-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 25px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .spotify-connect {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        #spotify-connection {
            text-decoration: none;
        }

        .spotify-btn {
            background: linear-gradient(45deg, #1db954, #1ed760);
            border: none;
            color: white;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .spotify-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(29, 185, 84, 0.3);
        }

        .search-box {
            width: 100%;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            color: #e1e5f2;
            font-size: 16px;
            backdrop-filter: blur(10px);
        }

        .search-box::placeholder {
            color: #8892b0;
        }

        .playlist-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 25px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            min-height: 400px;
        }

        .playlist-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .playlist-title {
            font-size: 1.4rem;
            font-weight: 600;
        }

        .song-count {
            background: rgba(102, 126, 234, 0.2);
            color: #667eea;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
        }

        .drop-zone {
            border: 2px dashed rgba(102, 126, 234, 0.5);
            border-radius: 15px;
            padding: 40px 20px;
            text-align: center;
            color: #8892b0;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }

        .drop-zone.dragover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
        }

        .song-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-height: 300px;
            overflow-y: auto;
        }

        .song-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid transparent;
        }

        .song-item:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(102, 126, 234, 0.3);
        }

        .song-item.playing {
            background: rgba(102, 126, 234, 0.2);
            border-color: #667eea;
        }

        .song-info {
            flex: 1;
        }

        .song-title {
            font-weight: 500;
            margin-bottom: 4px;
        }

        .song-artist {
            color: #8892b0;
            font-size: 0.9rem;
        }

        .right-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .player-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 25px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .now-playing {
            text-align: center;
            margin-bottom: 25px;
        }

        .album-art {
            width: 200px;
            height: 200px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            border-radius: 20px;
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .track-info h3 {
            font-size: 1.3rem;
            margin-bottom: 5px;
        }

        .track-info p {
            color: #8892b0;
        }

        .progress-section {
            margin: 25px 0;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            margin: 10px 0;
            cursor: pointer;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #667eea, #764ba2);
            border-radius: 3px;
            width: 0%;
            transition: width 0.1s ease;
        }

        .time-display {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            color: #8892b0;
        }

        .controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin: 20px 0;
        }

        .control-btn {
            background: transparent;
            border: none;
            color: #e1e5f2;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 10px;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .control-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: scale(1.1);
        }

        .play-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            font-size: 2rem;
            padding: 15px;
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.3);
        }

        .play-btn:hover {
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .volume-section {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-top: 20px;
        }

        .volume-slider {
            flex: 1;
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            cursor: pointer;
        }

        .volume-fill {
            height: 100%;
            background: linear-gradient(45deg, #667eea, #764ba2);
            border-radius: 2px;
            width: 70%;
        }

        .visualizer {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 25px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            height: 200px;
            display: flex;
            align-items: end;
            justify-content: center;
            gap: 3px;
            overflow: hidden;
        }

        .bar {
            width: 4px;
            background: linear-gradient(to top, #667eea, #764ba2);
            border-radius: 2px;
            animation: visualize 0.5s ease-in-out infinite alternate;
        }

        @keyframes visualize {
            from { height: 10px; }
            to { height: 60px; }
        }

        .recommendations {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 25px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .remove-btn {
            background: rgba(255, 107, 107, 0.2);
            border: none;
            color: #ff6b6b;
            padding: 5px 8px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .remove-btn:hover {
            background: rgba(255, 107, 107, 0.3);
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .album-art {
                width: 150px;
                height: 150px;
            }
            
            .logo {
                font-size: 2rem;
            }
        }

        .hidden {
            display: none;
        }

        .mode-content {
            margin-top: 20px;
        }

        .preset-songs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .preset-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid transparent;
        }

        .preset-item:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(102, 126, 234, 0.3);
        }

        .preset-title {
            font-weight: 500;
            margin-bottom: 5px;
        }

        .preset-description {
            color: #8892b0;
            font-size: 0.9rem;
        }

        .timer-display {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(102, 126, 234, 0.2);
            color: #667eea;
            padding: 10px 15px;
            border-radius: 20px;
            font-weight: 500;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .timer-controls {
            position: fixed;
            bottom: 20px;
            left: 20px;
            display: flex;
            gap: 10px;
        }

        .timer-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .timer-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="logo">🎧 Stydio</h1>
            <p class="tagline">Your perfect study companion for focus and relaxation</p>
        </div>

        <div class="main-content">
            <div class="left-panel">
                <!-- Mode Toggle -->
                <div class="mode-toggle">
                    <button class="mode-btn" data-mode="study">📚 Study Mode</button>
                    <button class="mode-btn active" data-mode="nap">😴 Nap Mode</button>
                    <button class="mode-btn" data-mode="custom">🎵 Custom Playlist</button>
                </div>

                <!-- Spotify Section -->
                <div class="spotify-section">
                    <div class="spotify-connect">
                        <a href="https://open.spotify.com/" id="spotify-connection" target="_blank">
                            <button class="spotify-btn" id="spotifyConnect">
                                🎵 Connect to Spotify
                            </button>
                        </a>
                        <span id="spotifyStatus" class="hidden">✅ Connected</span>
                    </div>
                    <input type="text" class="search-box" placeholder="Search for songs, artists, or albums..." id="searchInput">
                    
                    <div class="mode-content hidden" id="studyMode">
                        <h3>🎯 Focus Tracks</h3>
                        <div class="preset-songs">
                            <div class="preset-item" data-track="lofi-hip-hop">
                                <div class="preset-title">Lo-Fi Hip Hop</div>
                                <div class="preset-description">Chill beats for concentration</div>
                            </div>
                            <div class="preset-item" data-track="classical-focus">
                                <div class="preset-title">Classical Focus</div>
                                <div class="preset-description">Instrumental classical music</div>
                            </div>
                            <div class="preset-item" data-track="ambient-study">
                                <div class="preset-title">Ambient Study</div>
                                <div class="preset-description">Atmospheric background sounds</div>
                            </div>
                            <div class="preset-item" data-track="nature-sounds">
                                <div class="preset-title">Nature Sounds</div>
                                <div class="preset-description">Rain, forest, and ocean sounds</div>
                            </div>
                        </div>
                    </div>

                    <div class="mode-content" id="napMode">
                        <h3>😴 Sleep Sounds</h3>
                        <div class="preset-songs">
                            <div class="preset-item" data-track="white-noise">
                                <div class="preset-title">White Noise</div>
                                <div class="preset-description">Consistent background noise</div>
                            </div>
                            <div class="preset-item" data-track="rain-sounds">
                                <div class="preset-title">Gentle Rain</div>
                                <div class="preset-description">Soft rainfall for sleep</div>
                            </div>
                            <div class="preset-item" data-track="ocean-waves">
                                <div class="preset-title">Ocean Waves</div>
                                <div class="preset-description">Relaxing wave sounds</div>
                            </div>
                            <div class="preset-item" data-track="meditation">
                                <div class="preset-title">Meditation Bells</div>
                                <div class="preset-description">Peaceful meditation sounds</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Playlist Section -->
                <div class="playlist-section hidden" id="customPlaylist">
                    <div class="playlist-header">
                        <h3 class="playlist-title">My Playlist</h3>
                        <span class="song-count" id="songCount">0/10 songs</span>
                    </div>
                    
                    <div class="drop-zone" id="dropZone">
                        <p>🎵 Drop your music files here</p>
                        <p style="font-size: 0.9rem; margin-top: 10px;">Drag and drop up to 10 songs (MP3, WAV, OGG)</p>
                        <input type="file" multiple accept="audio/*" style="display: none;" id="fileInput">
                        <button style="margin-top: 15px; padding: 10px 20px; background: rgba(102, 126, 234, 0.2); border: none; color: #667eea; border-radius: 10px; cursor: pointer;" onclick="document.getElementById('fileInput').click()">
                            Choose Files
                        </button>
                    </div>
                    
                    <div class="song-list" id="songList"></div>
                </div>
            </div>

            <div class="right-panel">
                <!-- Music Player -->
                <div class="player-section">
                    <div class="now-playing">
                        <div class="album-art" id="albumArt">🎵</div>
                        <div class="track-info">
                            <h3 id="trackTitle">Select a song to play</h3>
                            <p id="trackArtist">Welcome to Stydio</p>
                        </div>
                    </div>

                    <div class="progress-section">
                        <div class="progress-bar" id="progressBar">
                            <div class="progress-fill" id="progressFill"></div>
                        </div>
                        <div class="time-display">
                            <span id="currentTime">0:00</span>
                            <span id="totalTime">0:00</span>
                        </div>
                    </div>

                    <div class="controls">
                        <button class="control-btn" id="shuffleBtn">🔀</button>
                        <button class="control-btn" id="prevBtn">⏮️</button>
                        <button class="control-btn play-btn" id="playPauseBtn">▶️</button>
                        <button class="control-btn" id="nextBtn">⏭️</button>
                        <button class="control-btn" id="repeatBtn">🔁</button>
                    </div>

                    <div class="volume-section">
                        <span>🔊</span>
                        <div class="volume-slider" id="volumeSlider">
                            <div class="volume-fill" id="volumeFill"></div>
                        </div>
                        <span id="volumePercent">70%</span>
                    </div>
                </div>

                <!-- Audio Visualizer -->
                <div class="visualizer" id="visualizer">
                    <!-- Dynamic bars will be generated here -->
                </div>

                <!-- Recommendations -->
                <div class="recommendations">
                    <h3 style="margin-bottom: 15px;">🎯 Recommended for You</h3>
                    <p style="color: #8892b0; font-size: 0.9rem;">Connect to Spotify to get personalized recommendations based on your listening habits.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Timer Display -->
    <div class="timer-display" id="timerDisplay">30:00</div>
    
    <!-- Timer Controls -->
    <div class="timer-controls">
        <button class="timer-btn" id="startTimer">Start Timer</button>
        <button class="timer-btn" id="resetTimer">Reset Timer</button>
    </div>

    <script>
        // Sample music data (in a real app, these would be actual audio files)
        const sampleMusic = [
            {
                title: "Relaxing Piano",
                artist: "Study Music",
                url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3",
                duration: 180
            },
            {
                title: "Ocean Waves",
                artist: "Nature Sounds",
                url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3",
                duration: 240
            },
            {
                title: "Lo-Fi Beats",
                artist: "Chill Vibes",
                url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3",
                duration: 210
            }
        ];

        class StydioPlayer {
            constructor() {
                this.currentTrack = null;
                this.isPlaying = false;
                this.currentTime = 0;
                this.duration = 0;
                this.volume = 0.7;
                this.playlist = [...sampleMusic]; // Start with sample music
                this.currentTrackIndex = -1;
                this.isShuffled = false;
                this.repeatMode = 'none'; // 'none', 'one', 'all'
                this.mode = 'nap';
                this.spotifyConnected = false;
                this.timerInterval = null;
                this.timeLeft = 30 * 60; // 30 minutes in seconds
                
                this.init();
            }

            init() {
                this.setupEventListeners();
                this.generateVisualizerBars();
                this.setupDragAndDrop();
                this.updatePlaylistUI();
                this.updateSongCount();
                this.updateTimerDisplay();
            }

            setupEventListeners() {
                // Mode toggle
                document.querySelectorAll('.mode-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => this.switchMode(e.target.dataset.mode));
                });

                // Player controls
                document.getElementById('playPauseBtn').addEventListener('click', () => this.togglePlayPause());
                document.getElementById('nextBtn').addEventListener('click', () => this.nextTrack());
                document.getElementById('prevBtn').addEventListener('click', () => this.previousTrack());
                document.getElementById('shuffleBtn').addEventListener('click', () => this.toggleShuffle());
                document.getElementById('repeatBtn').addEventListener('click', () => this.toggleRepeat());

                // Volume control
                const volumeSlider = document.getElementById('volumeSlider');
                volumeSlider.addEventListener('click', (e) => this.setVolume(e));

                // Progress bar
                const progressBar = document.getElementById('progressBar');
                progressBar.addEventListener('click', (e) => this.setProgress(e));

                // File input
                document.getElementById('fileInput').addEventListener('change', (e) => this.handleFileSelect(e));

                // Preset songs
                document.querySelectorAll('.preset-item').forEach(item => {
                    item.addEventListener('click', (e) => this.playPresetTrack(e.currentTarget.dataset.track));
                });

                // Timer controls
                document.getElementById('startTimer').addEventListener('click', () => this.toggleTimer());
                document.getElementById('resetTimer').addEventListener('click', () => this.resetTimer());
            }

            switchMode(mode) {
                this.mode = mode;
                
                // Update button states
                document.querySelectorAll('.mode-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.querySelector(`[data-mode="${mode}"]`).classList.add('active');

                // Show/hide content
                document.getElementById('studyMode').classList.toggle('hidden', mode !== 'study');
                document.getElementById('napMode').classList.toggle('hidden', mode !== 'nap');
                document.getElementById('customPlaylist').classList.toggle('hidden', mode !== 'custom');
            }

            generateVisualizerBars() {
                const visualizer = document.getElementById('visualizer');
                visualizer.innerHTML = '';
                
                for (let i = 0; i < 40; i++) {
                    const bar = document.createElement('div');
                    bar.className = 'bar';
                    bar.style.animationDelay = `${Math.random() * 0.5}s`;
                    bar.style.height = `${Math.random() * 50 + 10}px`;
                    visualizer.appendChild(bar);
                }
            }

            setupDragAndDrop() {
                const dropZone = document.getElementById('dropZone');
                
                ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                    dropZone.addEventListener(eventName, this.preventDefaults, false);
                });

                ['dragenter', 'dragover'].forEach(eventName => {
                    dropZone.addEventListener(eventName, () => dropZone.classList.add('dragover'), false);
                });

                ['dragleave', 'drop'].forEach(eventName => {
                    dropZone.addEventListener(eventName, () => dropZone.classList.remove('dragover'), false);
                });

                dropZone.addEventListener('drop', (e) => this.handleDrop(e), false);
            }

            preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }

            handleDrop(e) {
                const files = Array.from(e.dataTransfer.files);
                this.addFilesToPlaylist(files);
            }

            handleFileSelect(e) {
                const files = Array.from(e.target.files);
                this.addFilesToPlaylist(files);
            }

            addFilesToPlaylist(files) {
                const audioFiles = files.filter(file => file.type.startsWith('audio/'));
                const remainingSlots = 10 - this.playlist.length;
                const filesToAdd = audioFiles.slice(0, remainingSlots);

                filesToAdd.forEach(file => {
                    const url = URL.createObjectURL(file);
                    const song = {
                        title: file.name.replace(/\.[^/.]+$/, ""),
                        artist: 'Local File',
                        url: url,
                        file: file,
                        duration: 0 // Will be updated when loaded
                    };
                    this.playlist.push(song);
                });

                this.updatePlaylistUI();
                this.updateSongCount();
            }

            updatePlaylistUI() {
                const songList = document.getElementById('songList');
                songList.innerHTML = '';

                this.playlist.forEach((song, index) => {
                    const songItem = document.createElement('div');
                    songItem.className = 'song-item';
                    if (index === this.currentTrackIndex) {
                        songItem.classList.add('playing');
                    }
                    
                    songItem.innerHTML = `
                        <div class="song-info">
                            <div class="song-title">${song.title}</div>
                            <div class="song-artist">${song.artist}</div>
                        </div>
                        <button class="remove-btn" data-index="${index}">×</button>
                    `;
                    
                    songItem.addEventListener('click', (e) => {
                        if (!e.target.classList.contains('remove-btn')) {
                            this.playTrack(index);
                        }
                    });
                    
                    // Add event listener to remove button
                    const removeBtn = songItem.querySelector('.remove-btn');
                    removeBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        this.removeSong(index);
                    });
                    
                    songList.appendChild(songItem);
                });
            }

            removeSong(index) {
                if (this.playlist[index] && this.playlist[index].url) {
                    URL.revokeObjectURL(this.playlist[index].url);
                }
                this.playlist.splice(index, 1);
                
                if (this.currentTrackIndex === index) {
                    this.stopTrack();
                } else if (this.currentTrackIndex > index) {
                    this.currentTrackIndex--;
                }
                
                this.updatePlaylistUI();
                this.updateSongCount();
            }

            updateSongCount() {
                document.getElementById('songCount').textContent = `${this.playlist.length}/10 songs`;
            }

            playTrack(index) {
                if (index >= 0 && index < this.playlist.length) {
                    if (this.currentTrack) {
                        this.currentTrack.pause();
                    }
                    
                    this.currentTrackIndex = index;
                    const song = this.playlist[index];
                    
                    this.currentTrack = new Audio(song.url);
                    this.currentTrack.volume = this.volume;
                    
                    this.currentTrack.addEventListener('loadedmetadata', () => {
                        this.duration = this.currentTrack.duration;
                        this.updateTrackInfo(song);
                        this.updateTimeDisplay();
                    });

                    this.currentTrack.addEventListener('timeupdate', () => {
                        this.currentTime = this.currentTrack.currentTime;
                        this.updateProgress();
                        this.updateTimeDisplay();
                    });

                    this.currentTrack.addEventListener('ended', () => {
                        this.handleTrackEnd();
                    });

                    this.currentTrack.play()
                        .then(() => {
                            this.isPlaying = true;
                            this.updatePlayButton();
                            this.updatePlaylistUI();
                        })
                        .catch(error => {
                            console.error('Playback failed:', error);
                        });
                }
            }

            stopTrack() {
                if (this.currentTrack) {
                    this.currentTrack.pause();
                    this.currentTrack.currentTime = 0;
                    this.isPlaying = false;
                    this.updatePlayButton();
                    this.updateTimeDisplay();
                }
            }

            togglePlayPause() {
                if (this.currentTrack) {
                    if (this.isPlaying) {
                        this.currentTrack.pause();
                    } else {
                        this.currentTrack.play();
                    }
                    this.isPlaying = !this.isPlaying;
                    this.updatePlayButton();
                } else if (this.playlist.length > 0) {
                    // If no track is selected but playlist has songs, play the first one
                    this.playTrack(0);
                }
            }

            updatePlayButton() {
                const playPauseBtn = document.getElementById('playPauseBtn');
                playPauseBtn.textContent = this.isPlaying ? '⏸️' : '▶️';
            }

            nextTrack() {
                if (this.playlist.length === 0) return;
                
                let nextIndex;
                if (this.isShuffled) {
                    nextIndex = Math.floor(Math.random() * this.playlist.length);
                    while (nextIndex === this.currentTrackIndex && this.playlist.length > 1) {
                        nextIndex = Math.floor(Math.random() * this.playlist.length);
                    }
                } else {
                    nextIndex = (this.currentTrackIndex + 1) % this.playlist.length;
                }
                
                this.playTrack(nextIndex);
            }

            previousTrack() {
                if (this.playlist.length === 0) return;
                
                let prevIndex;
                if (this.isShuffled) {
                    prevIndex = Math.floor(Math.random() * this.playlist.length);
                    while (prevIndex === this.currentTrackIndex && this.playlist.length > 1) {
                        prevIndex = Math.floor(Math.random() * this.playlist.length);
                    }
                } else {
                    prevIndex = (this.currentTrackIndex - 1 + this.playlist.length) % this.playlist.length;
                }
                
                this.playTrack(prevIndex);
            }

            toggleShuffle() {
                this.isShuffled = !this.isShuffled;
                const shuffleBtn = document.getElementById('shuffleBtn');
                shuffleBtn.style.color = this.isShuffled ? '#667eea' : '#e1e5f2';
            }

            toggleRepeat() {
                const repeatModes = ['none', 'one', 'all'];
                const currentIndex = repeatModes.indexOf(this.repeatMode);
                this.repeatMode = repeatModes[(currentIndex + 1) % repeatModes.length];
                
                const repeatBtn = document.getElementById('repeatBtn');
                repeatBtn.style.color = this.repeatMode !== 'none' ? '#667eea' : '#e1e5f2';
                
                if (this.currentTrack) {
                    this.currentTrack.loop = this.repeatMode === 'one';
                }
            }

            handleTrackEnd() {
                if (this.repeatMode === 'one') {
                    this.currentTrack.currentTime = 0;
                    this.currentTrack.play();
                } else if (this.repeatMode === 'all') {
                    this.nextTrack();
                } else {
                    this.isPlaying = false;
                    this.updatePlayButton();
                }
            }

            setVolume(e) {
                const volumeSlider = document.getElementById('volumeSlider');
                const rect = volumeSlider.getBoundingClientRect();
                const pos = (e.clientX - rect.left) / rect.width;
                this.volume = Math.max(0, Math.min(1, pos));
                
                if (this.currentTrack) {
                    this.currentTrack.volume = this.volume;
                }
                
                document.getElementById('volumeFill').style.width = `${this.volume * 100}%`;
                document.getElementById('volumePercent').textContent = `${Math.round(this.volume * 100)}%`;
            }

            setProgress(e) {
                if (!this.currentTrack) return;
                
                const progressBar = document.getElementById('progressBar');
                const rect = progressBar.getBoundingClientRect();
                const pos = (e.clientX - rect.left) / rect.width;
                this.currentTrack.currentTime = pos * this.duration;
            }

            updateProgress() {
                if (this.duration > 0) {
                    const progress = (this.currentTime / this.duration) * 100;
                    document.getElementById('progressFill').style.width = `${progress}%`;
                }
            }

            updateTimeDisplay() {
                document.getElementById('currentTime').textContent = this.formatTime(this.currentTime);
                document.getElementById('totalTime').textContent = this.formatTime(this.duration);
            }

            updateTrackInfo(song) {
                document.getElementById('trackTitle').textContent = song.title;
                document.getElementById('trackArtist').textContent = song.artist;
                document.getElementById('albumArt').textContent = '🎵';
            }

            formatTime(seconds) {
                if (isNaN(seconds)) return '0:00';
                
                const mins = Math.floor(seconds / 60);
                const secs = Math.floor(seconds % 60);
                return `${mins}:${secs < 10 ? '0' : ''}${secs}`;
            }

            playPresetTrack(trackType) {
                // In a real app, these would play actual audio files
                const presetTracks = {
                    'lofi-hip-hop': { title: 'Lo-Fi Study Mix', artist: 'Chill Beats Collective', duration: 180 },
                    'classical-focus': { title: 'Bach - Air on G String', artist: 'Johann Sebastian Bach', duration: 240 },
                    'ambient-study': { title: 'Atmospheric Focus', artist: 'Ambient Sounds', duration: 210 },
                    'nature-sounds': { title: 'Forest Rain', artist: 'Nature Recordings', duration: 300 },
                    'white-noise': { title: 'White Noise Generator', artist: 'Sleep Sounds', duration: 360 },
                    'rain-sounds': { title: 'Gentle Rain', artist: 'Nature Sounds', duration: 300 },
                    'ocean-waves': { title: 'Ocean Waves', artist: 'Coastal Sounds', duration: 300 },
                    'meditation': { title: 'Tibetan Bells', artist: 'Meditation Music', duration: 240 }
                };

                const track = presetTracks[trackType];
                if (track) {
                    this.updateTrackInfo(track);
                    this.isPlaying = true;
                    this.updatePlayButton();
                    
                    // For demo purposes, we'll simulate progress
                    this.duration = track.duration;
                    this.currentTime = 0;
                    this.updateTimeDisplay();
                    
                    if (this._simulateInterval) {
                        clearInterval(this._simulateInterval);
                    }
                    
                    this._simulateInterval = setInterval(() => {
                        if (!this.isPlaying) return;
                        
                        this.currentTime += 1;
                        if (this.currentTime >= this.duration) {
                            this.currentTime = this.duration;
                            clearInterval(this._simulateInterval);
                            this.handleTrackEnd();
                        }
                        this.updateProgress();
                        this.updateTimeDisplay();
                    }, 1000);
                }
            }

            // Timer functions
            toggleTimer() {
                const startBtn = document.getElementById('startTimer');
                
                if (this.timerInterval) {
                    clearInterval(this.timerInterval);
                    this.timerInterval = null;
                    startBtn.textContent = 'Start Timer';
                } else {
                    this.timerInterval = setInterval(() => this.updateTimer(), 1000);
                    startBtn.textContent = 'Pause Timer';
                }
            }

            resetTimer() {
                this.timeLeft = 30 * 60; // Reset to 30 minutes
                this.updateTimerDisplay();
                
                if (this.timerInterval) {
                    clearInterval(this.timerInterval);
                    this.timerInterval = null;
                    document.getElementById('startTimer').textContent = 'Start Timer';
                }
            }

            updateTimer() {
                this.timeLeft -= 1;
                this.updateTimerDisplay();
                
                if (this.timeLeft <= 0) {
                    clearInterval(this.timerInterval);
                    this.timerInterval = null;
                    document.getElementById('startTimer').textContent = 'Start Timer';
                    
                    // Return to home page after timer ends
                    setTimeout(() => {
                        alert('Your 30-minute session is complete! Time for a break.');
                        window.location.href = '/'; // Replace with your home page URL
                    }, 1000);
                }
            }

            updateTimerDisplay() {
                const minutes = Math.floor(this.timeLeft / 60);
                const seconds = this.timeLeft % 60;
                document.getElementById('timerDisplay').textContent = 
                    `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
            }
        }

        // Initialize the player when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            window.stydio = new StydioPlayer();
        });
    </script>
</body>
</html>